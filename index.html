<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤</title>
  <style>
    :root{
      --bg:#f7f7fb; --card:#ffffff; --bd:#e5e7eb; --tx:#111827; --mut:#6b7280;
      --ok:#065f46; --hi:#92400e; --lo:#9f1239; --warn:#374151;
      --btn:#111827; --btnTx:#ffffff;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--tx); }
    .wrap{ max-width:1200px; margin:0 auto; padding:18px; }
    .top{ display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end; justify-content:space-between; margin-bottom:14px; }
    h1{ margin:0; font-size:20px; }
    .note{ color:var(--mut); font-size:13px; margin-top:6px; }
    .row{ display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap; }
    .card{ background:var(--card); border:1px solid var(--bd); border-radius:14px; padding:14px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }
    label{ display:block; font-size:13px; color:var(--mut); margin-bottom:6px; }
    input[type="number"], input[type="text"], select{
      padding:10px 12px; border:1px solid var(--bd); border-radius:10px; background:white; font-size:14px;
    }
    input.small{ width:140px; }
    input.value{ width:160px; }
    select.small{ width:220px; }

    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--bd);
      border-radius:999px; background:white; color:var(--mut); font-size:13px;
    }
    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    button{
      padding:10px 12px; border-radius:12px; border:1px solid var(--bd);
      background:white; cursor:pointer; font-weight:700;
    }
    button.primary{ background:var(--btn); color:var(--btnTx); border-color:var(--btn); }
    button:hover{ filter:brightness(.98); }
    .mut{ color:var(--mut); }
    .hidden{ display:none !important; }
    .table{
      width:100%; border-collapse:separate; border-spacing:0; overflow:hidden;
      border:1px solid var(--bd); border-radius:14px; background:white;
    }
    .table th, .table td{ padding:10px; border-bottom:1px solid var(--bd); font-size:13px; vertical-align:top; }
    .table th{ text-align:left; color:var(--mut); font-weight:800; background:#fafafa; }
    .table tr:last-child td{ border-bottom:none; }
    .s-ok{ color:var(--ok); font-weight:800; }
    .s-hi{ color:var(--hi); font-weight:800; }
    .s-lo{ color:var(--lo); font-weight:800; }
    .s-warn{ color:var(--warn); font-weight:800; }
    .err{ color:#b91c1c; font-weight:800; margin-top:8px; }
    .mini{ font-size:12px; color:var(--mut); }
    .divider{ height:1px; background:var(--bd); margin:12px 0; }

    /* —Å–∫—Ä—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—á–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã) */
    .hdr{ display:none !important; }

    /* ====== –í–í–û–î: –û–î–ò–ù –°–¢–û–õ–ë–ï–¶ (–∫–∞—Ä—Ç–æ—á–∫–∏) ====== */
    .inputs{
      display:flex !important;
      flex-direction:column !important;
      gap:14px;
    }
    .inputs > div{
      display:flex;
      flex-direction:column;
      gap:8px;
      padding:14px;
      border:1px solid var(--bd);
      border-radius:14px;
      background:#fff;
    }
    /* –ø–µ—Ä–µ–±–∏–≤–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à–∏—Ä–∏–Ω—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .inputs input,
    .inputs select{
      width:100% !important;
      max-width:100% !important;
    }

    /* –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏: –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å–ª–µ–≤–∞, –µ–¥–∏–Ω–∏—Ü—ã —Å–ø—Ä–∞–≤–∞ */
    .field-head{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
    }
    .field-unit{
      font-size:12px;
      color:var(--mut);
      font-weight:800;
      white-space:nowrap;
    }

    details summary{
      cursor:pointer;
      user-select:none;
      color:#111827;
      font-weight:800;
    }
    details .mini{ margin-top:6px; }
    ul{ margin:6px 0 0 16px; padding:0; }

    .memo{
      border:1px dashed var(--bd);
      border-radius:12px;
      padding:10px;
      background:#fff;
      margin-bottom:10px;
    }
    .memo b{ display:block; margin-bottom:6px; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤</h1>
      <div class="note">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–∞–º–∏ –∏ –ø–∞–º—è—Ç–∫–∞–º–∏. –ù–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –¥–∏–∞–≥–Ω–æ–∑.</div>
    </div>

    <div class="row">
      <div>
        <label for="analysisType">–ß—Ç–æ –æ—Ü–µ–Ω–∏–≤–∞–µ–º</label>
        <select id="analysisType" class="small">
          <option value="blood">–ö—Ä–æ–≤—å (–û–ê–ö)</option>
          <option value="coprogram">–ö–æ–ø—Ä–æ–≥—Ä–∞–º–º–∞</option>
        </select>
      </div>

      <div id="ageBox">
        <label for="age">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç, –º–æ–∂–Ω–æ –¥—Ä–æ–±–Ω–æ: 0.5 = 6 –º–µ—Å—è—Ü–µ–≤)</label>
        <input id="age" class="small" type="number" min="0" max="18" step="0.1" value="6" />
      </div>

      <div>
        <label for="sex">–ü–æ–ª (–≤–∞–∂–Ω–æ –¥–ª—è HCT 12+)</label>
        <select id="sex" class="small">
          <option value="any">–Ω–µ –≤–∞–∂–Ω–æ</option>
          <option value="female">–¥–µ–≤–æ—á–∫–∞</option>
          <option value="male">–º–∞–ª—å—á–∏–∫</option>
        </select>
      </div>

      <div class="pill" id="agePill">‚Äî</div>
    </div>
  </div>

  <div class="grid">
    <!-- –í–≤–æ–¥ -->
    <div class="card">
      <label id="inputTitle">–í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</label>
      <div class="mini" id="inputHint">–í–ø–∏—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏ ‚Äú–ü—Ä–æ–≤–µ—Ä–∏—Ç—å‚Äù.</div>
      <div class="divider"></div>

      <div class="hdr" id="hdrRow">
        <div>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</div>
        <div>–ó–Ω–∞—á–µ–Ω–∏–µ</div>
        <div>–ï–¥.</div>
      </div>

      <div id="inputs" class="inputs"></div>

      <div class="btns">
        <button class="primary" id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button id="fillDemoBtn">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏–º–µ—Ä</button>
        <button id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="csvBtn">–°–∫–∞—á–∞—Ç—å CSV</button>
      </div>

      <div class="err" id="error"></div>
    </div>

    <!-- –û—Ç—á—ë—Ç -->
    <div class="card">
      <label>–û—Ç—á—ë—Ç</label>
      <div id="report" class="mut">–ó–∞–ø–æ–ª–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏ ‚Äú–ü—Ä–æ–≤–µ—Ä–∏—Ç—å‚Äù.</div>
      <div class="divider"></div>
      <div class="mini">
        ‚ö†Ô∏è –í–∞–∂–Ω–æ: —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –ø–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –∏ –º–µ—Ç–æ–¥–∏–∫–µ. –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –≤—Ä–∞—á–æ–º.
      </div>
    </div>
  </div>
</div>

<script>
/** =========================================================
 *  0) –ï–î–ò–ù–´–ï –ö–õ–Æ–ß–ò (—á—Ç–æ–±—ã –Ω–æ—Ä–º—ã/–ø—Ä–∏—á–∏–Ω—ã –Ω–µ "–ø—Ä–æ–ø–∞–¥–∞–ª–∏")
 *  ========================================================= */
const K = {
  WBC:"–õ–µ–π–∫–æ—Ü–∏—Ç—ã (WBC)",
  RBC:"–≠—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã (RBC)",
  HGB:"–ì–µ–º–æ–≥–ª–æ–±–∏–Ω (HGB)",
  HCT:"–ì–µ–º–∞—Ç–æ–∫—Ä–∏—Ç (HCT)",
  MCV:"–°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º —ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç–æ–≤ (MCV)",
  MCH:"–°—Ä–µ–¥–Ω. —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≥–µ–º–æ–≥–ª–æ–±–∏–Ω–∞ –≤ —ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç–µ (MCH)",
  MCHC:"–°—Ä–µ–¥–Ω. –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –≥–µ–º–æ–≥–ª–æ–±–∏–Ω–∞ –≤ —ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç–∞—Ö (MCHC)",
  RDW_CV:"RDW-CV",
  RDW_SD:"RDW-SD",
  PLT:"–¢—Ä–æ–º–±–æ—Ü–∏—Ç—ã (PLT)",
  PCT:"–¢—Ä–æ–º–±–æ–∫—Ä–∏—Ç (PCT)",
  PDW:"PDW",
  PLCR:"P-LCR",
  BA:"–ë–∞–∑–æ—Ñ–∏–ª—ã (BA), %",
  EO_ABS:"–≠–æ–∑–∏–Ω–æ—Ñ–∏–ª—ã (EO), –∞–±—Å.",
  NE_ABS:"–ù–µ–π—Ç—Ä–æ—Ñ–∏–ª—ã (NE), –∞–±—Å.",
  LY_PCT:"–õ–∏–º—Ñ–æ—Ü–∏—Ç—ã (LY), %",
  MO_PCT:"–ú–æ–Ω–æ—Ü–∏—Ç—ã (MO), %",
  ESR:"–°–û–≠"
};

/** =========================================================
 *  1) –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫—Ä–æ–≤–∏
 *  ========================================================= */
const BLOOD_INDICATORS = [
  { key: K.WBC, unit: "10^9/–ª" },
  { key: K.RBC, unit: "10^12/–ª" },
  { key: K.HGB, unit: "–≥/–ª" },
  { key: K.HCT, unit: "%" },
  { key: K.MCV, unit: "—Ñ–ª" },
  { key: K.MCH, unit: "–ø–≥" },
  { key: K.MCHC, unit: "–≥/–ª" },
  { key: K.RDW_CV, unit: "%" },
  { key: K.RDW_SD, unit: "—Ñ–ª" },
  { key: K.PLT, unit: "10^9/–ª" },
  { key: K.PCT, unit: "%" },
  { key: K.PDW, unit: "%" },
  { key: K.PLCR, unit: "%" },
  { key: K.BA, unit: "%" },
  { key: K.EO_ABS, unit: "10^9/–ª" },
  { key: K.NE_ABS, unit: "10^9/–ª" },
  { key: K.LY_PCT, unit: "%" },
  { key: K.MO_PCT, unit: "%" },
  { key: K.ESR, unit: "–º–º/—á" },
];

/** =========================================================
 *  2) –ù–æ—Ä–º—ã –∫—Ä–æ–≤–∏ (–ø–æ —Ç–≤–æ–∏–º —Ñ–æ—Ç–æ)
 *  ========================================================= */
const BLOOD_NORMS = {
  [K.WBC]: [
    {a0:0, a1:1/12, min:9.0, max:30.0, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:1,   min:6.0, max:17.5, label:"1 –º–µ—Å—è—Ü‚Äì1 –≥–æ–¥"},
    {a0:1, a1:2,      min:6.0, max:17.0, label:"1‚Äì2 –≥–æ–¥–∞"},
    {a0:2, a1:4,      min:5.5, max:15.5, label:"2‚Äì4 –≥–æ–¥–∞"},
    {a0:4, a1:6,      min:5.0, max:14.5, label:"4‚Äì6 –ª–µ—Ç"},
    {a0:6, a1:15,     min:4.5, max:13.5, label:"6‚Äì15 –ª–µ—Ç"},
    {a0:15, a1:99,    min:4.0, max:9.0,  label:"15+ –ª–µ—Ç"},
  ],
  [K.RBC]: [
    {a0:0, a1:1/12,   min:3.8, max:5.6, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.5, min:3.5, max:4.5, label:"1‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:1,    min:3.9, max:5.1, label:"6‚Äì12 –º–µ—Å—è—Ü–µ–≤"},
    {a0:1, a1:12,     min:3.9, max:5.5, label:"1‚Äì12 –ª–µ—Ç"},
    {a0:12, a1:99,    min:4.3, max:5.5, label:"12+ –ª–µ—Ç"},
  ],
  [K.HGB]: [
    {a0:0, a1:1/12,   min:130, max:200, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.5, min:90,  max:120, label:"1‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:5,    min:115, max:140, label:"6 –º–µ—Å—è—Ü–µ–≤‚Äì5 –ª–µ—Ç"},
    {a0:5, a1:12,     min:125, max:135, label:"5‚Äì12 –ª–µ—Ç"},
    {a0:12, a1:99,    min:125, max:140, label:"12+ –ª–µ—Ç"},
  ],
  [K.HCT]: [
    {a0:0, a1:1/12,   min:34, max:55, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.5, min:32, max:43, label:"1‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:2,    min:33, max:39, label:"6 –º–µ—Å—è—Ü–µ–≤‚Äì2 –≥–æ–¥–∞"},
    {a0:2, a1:6,      min:34, max:40, label:"2‚Äì6 –ª–µ—Ç"},
    {a0:6, a1:12,     min:35, max:45, label:"6‚Äì12 –ª–µ—Ç"},
    {a0:12, a1:99, sex:"female", min:36, max:46, label:"12+ (–¥–µ–≤–æ—á–∫–∏)"},
    {a0:12, a1:99, sex:"male",   min:37, max:49, label:"12+ (–º–∞–ª—å—á–∏–∫–∏)"},
  ],
  [K.MCV]: [
    {a0:0, a1:1/12,   min:80, max:95,  label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.25,min:88, max:100, label:"1‚Äì3 –º–µ—Å—è—Ü–∞"},
    {a0:0.25, a1:0.5, min:75, max:95,  label:"3‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:2,    min:70, max:85,  label:"6 –º–µ—Å—è—Ü–µ–≤‚Äì2 –≥–æ–¥–∞"},
    {a0:2, a1:12,     min:75, max:87,  label:"2‚Äì12 –ª–µ—Ç"},
    {a0:12, a1:99,    min:88, max:95,  label:"12+ –ª–µ—Ç"},
  ],
  [K.MCH]: [
    {a0:0, a1:1/12,   min:31, max:37, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.5, min:27, max:36, label:"1‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:2,    min:25, max:28, label:"6 –º–µ—Å—è—Ü–µ–≤‚Äì2 –≥–æ–¥–∞"},
    {a0:2, a1:99,     min:28, max:32, label:"2+ –≥–æ–¥–∞"},
  ],
  [K.MCHC]: [{a0:0, a1:99, min:320, max:360, label:"–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–∞"}],
  [K.RDW_CV]: [{a0:0, a1:99, min:11, max:15, label:"–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–∞"}],
  [K.RDW_SD]: [{a0:0, a1:99, min:35, max:60, label:"–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–∞"}],
  [K.PLT]: [
    {a0:0, a1:1/12, min:180, max:490, label:"–Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã–µ‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:1, min:180, max:400, label:"0‚Äì1 –≥–æ–¥"},
    {a0:1, a1:5,    min:160, max:390, label:"1‚Äì5 –ª–µ—Ç"},
    {a0:5, a1:10,   min:160, max:380, label:"6‚Äì10 –ª–µ—Ç"},
    {a0:10, a1:13,  min:160, max:360, label:"10‚Äì13 –ª–µ—Ç"},
    {a0:13, a1:15,  min:180, max:320, label:"13‚Äì15 –ª–µ—Ç"},
    {a0:15, a1:99,  min:180, max:390, label:"15+ –ª–µ—Ç"},
  ],
  [K.PCT]: [{a0:0, a1:99, min:0.108, max:0.282, label:"–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–∞"}],
  [K.PDW]: [{a0:0, a1:99, min:9, max:16, label:"–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–∞"}],
  [K.PLCR]: [{a0:0, a1:99, min:13, max:43, label:"–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–∞"}],
  [K.ESR]: [
    {a0:0, a1:1/12, min:2, max:4,   label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:2, min:4, max:10,  label:"1 –º–µ—Å—è—Ü‚Äì2 –≥–æ–¥–∞"},
    {a0:2, a1:12,   min:4, max:15,  label:"2‚Äì12 –ª–µ—Ç"},
    {a0:12, a1:99,  min:4, max:18,  label:"12+ –ª–µ—Ç"},
  ],
  [K.BA]: [{a0:0, a1:99, min:0, max:1, label:"—Ä–µ—Ñ–µ—Ä–µ–Ω—Å 0‚Äì1%"}],
  [K.EO_ABS]: [
    {a0:0, a1:1/12,   min:0, max:0.5, label:"0‚Äì1 –º–µ—Å—è—Ü (–¥–æ 0.5)"},
    {a0:1/12, a1:5/12,min:0, max:0.6, label:"1‚Äì5 –º–µ—Å—è—Ü–µ–≤ (–¥–æ 0.6)"},
    {a0:5/12, a1:2,   min:0, max:0.5, label:"5 –º–µ—Å‚Äì2 –≥–æ–¥–∞ (–¥–æ 0.5)"},
    {a0:2, a1:5,      min:0, max:0.7, label:"2‚Äì5 –ª–µ—Ç (–¥–æ 0.7)"},
    {a0:5, a1:99,     min:0, max:0.5, label:"5+ –ª–µ—Ç (–¥–æ 0.5)"},
  ],
  [K.NE_ABS]: [
    {a0:0, a1:1/12,   min:1.0, max:20.0, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.25,min:1.0, max:9.5,  label:"1‚Äì3 –º–µ—Å—è—Ü–∞"},
    {a0:0.25, a1:0.5, min:1.0, max:8.5,  label:"3‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:5,    min:1.5, max:8.5,  label:"6 –º–µ—Å‚Äì5 –ª–µ—Ç"},
    {a0:5, a1:18,     min:1.7, max:7.5,  label:"5‚Äì18 –ª–µ—Ç"},
  ],
  [K.LY_PCT]: [
    {a0:0, a1:1/12,   min:45, max:70, label:"0‚Äì1 –º–µ—Å—è—Ü"},
    {a0:1/12, a1:0.5, min:45, max:70, label:"1‚Äì6 –º–µ—Å—è—Ü–µ–≤"},
    {a0:0.5, a1:1,    min:50, max:70, label:"6‚Äì12 –º–µ—Å—è—Ü–µ–≤"},
    {a0:1, a1:3,      min:35, max:60, label:"1‚Äì3 –≥–æ–¥–∞"},
    {a0:3, a1:6,      min:33, max:55, label:"3‚Äì6 –ª–µ—Ç"},
    {a0:6, a1:12,     min:30, max:46, label:"6‚Äì12 –ª–µ—Ç"},
    {a0:12, a1:99,    min:18, max:45, label:"12+ –ª–µ—Ç"},
  ],
  [K.MO_PCT]: [
    {a0:0, a1:2/52,   min:5, max:15, label:"0‚Äì2 –Ω–µ–¥–µ–ª–∏"},
    {a0:2/52, a1:1,   min:4, max:10, label:"2 –Ω–µ–¥–µ–ª–∏‚Äì1 –≥–æ–¥"},
    {a0:1, a1:2,      min:3, max:10, label:"1‚Äì2 –≥–æ–¥–∞"},
    {a0:2, a1:99,     min:3, max:9,  label:"2+ –≥–æ–¥–∞"},
  ],
};

/** =========================================================
 *  3) –ü—Ä–∏—á–∏–Ω—ã –∫—Ä–æ–≤–∏
 *  ========================================================= */
const BLOOD_REASONS = {
  [K.HGB]: {
    high:["–æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ","–≥–∏–ø–æ–∫—Å–∏—è","—Å–∏–Ω–¥—Ä–æ–º —Ä–∞–∑–¥—Ä–∞–∂—ë–Ω–Ω–æ–≥–æ –∫–∏—à–µ—á–Ω–∏–∫–∞","—Å–∞—Ö–∞—Ä–Ω—ã–π –¥–∏–∞–±–µ—Ç","–¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏","–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ –∫–æ—Å—Ç–Ω–æ–≥–æ –º–æ–∑–≥–∞"],
    low:["–¥–µ—Ñ–∏—Ü–∏—Ç –±–µ–ª–∫–∞","–≤–∏—Ç–∞–º–∏–Ω–∞ C, –º–µ–¥–∏, –º–∞—Ä–≥–∞–Ω—Ü–∞","–≤–∏—Ç–∞–º–∏–Ω–∞ B12, B9, B1","–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞","–≥–∏–ø–æ–∞—Ü–∏–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è","–≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å—Ç–≤–æ","–∫—Ä–æ–≤–æ–ø–æ—Ç–µ—Ä–∏"]
  },
  [K.RBC]: {
    high:["–ø–æ–¥—ä—ë–º –Ω–∞ –≤—ã—Å–æ—Ç—É (–∂–∏—Ç–µ–ª–∏ –≤—ã—Å–æ–∫–æ–≥–æ—Ä—å—è)","—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏","–¥–µ–≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è","–æ–∂–∏—Ä–µ–Ω–∏–µ"],
    low:["–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–∞ B12, B9, B6","–¥–µ—Ñ–∏—Ü–∏—Ç –∂–µ–ª–µ–∑–∞","–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è –ø–æ—á–µ–∫ –∏ –ø–µ—á–µ–Ω–∏","—Å–∫—Ä—ã—Ç–æ–µ –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ"]
  },
  [K.MCV]: {
    high:["–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–æ–≤ B9, B12","—Å–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –Ω–∞—Ç—Ä–∏—è –≤ –∫—Ä–æ–≤–∏"],
    low:["–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–∞ C, B, –º–µ–¥–∏","—Å–Ω–∏–∂–µ–Ω–∏–µ –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∂–µ–ª—É–¥–æ—á–Ω–æ–≥–æ —Å–æ–∫–∞","–ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –Ω–∞—Ç—Ä–∏—è"]
  },
  [K.MCHC]: {
    high:["–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–∞ B9, B12, B2","–≥–∏–ø–æ—Ç–∏—Ä–µ–æ–∑"],
    low:["–∂–µ–ª–µ–∑–æ–¥–µ—Ñ–∏—Ü–∏—Ç–Ω–∞—è –∞–Ω–µ–º–∏—è","–≥–µ–º–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–µ–º–∏—è","–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–∞ C","–ø–æ–Ω–∏–∂–µ–Ω–∏–µ –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∂–µ–ª—É–¥–æ—á–Ω–æ–≥–æ —Å–æ–∫–∞"]
  },
  [K.PLT]: {
    high:["–æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ (—Ä–≤–æ—Ç–∞/–¥–∏–∞—Ä–µ—è)","–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∂–∏–¥–∫–æ—Å—Ç–∏","–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞","–ª–∏—Ö–æ—Ä–∞–¥–∫–∞ —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º –ø–æ—Ç–æ–æ—Ç–¥–µ–ª–µ–Ω–∏–µ–º","–∞–Ω–µ–º–∏—è —Ä–∞–∑–Ω–æ–π —ç—Ç–∏–æ–ª–æ–≥–∏–∏","–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã","–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–∞ E"],
    low:["–≥–µ—Ä–ø–µ—Å-–≤–∏—Ä—É—Å–Ω—ã–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏","–ø—Ä–∏—ë–º –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤","–¥–µ—Ñ–∏—Ü–∏—Ç B9, B12","–≤–∞–∫—Ü–∏–Ω–∞—Ü–∏—è","–∞—É—Ç–æ–∏–º–º—É–Ω–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è (–∞—É—Ç–æ–∏–º–º—É–Ω–Ω—ã–π —Ç–∏—Ä–µ–æ–∏–¥–∏—Ç, —Ä–µ–≤–º–∞—Ç–æ–∏–¥–Ω—ã–π –∞—Ä—Ç—Ä–∏—Ç, —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫—Ä–∞—Å–Ω–∞—è –≤–æ–ª—á–∞–Ω–∫–∞)"]
  },
  [K.PCT]: {
    high:["–≥–∏–ø–µ—Ä—Ç–∏—Ä–µ–æ–∑","–°–î","–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"],
    low:["–ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ —Ç—Ä–æ–º–±–æ—Ü–∏—Ç–æ–≤","–∞–Ω–µ–º–∏—è","–∞–ª–ª–µ—Ä–≥–∏—è","–¥–µ—Ñ–∏—Ü–∏—Ç B9"]
  },
  [K.RDW_CV]: {
    high:["–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–æ–≤ B9, B12","–Ω–∞—á–∞–ª–æ –¥–µ—Ñ–∏—Ü–∏—Ç–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è","–ø–æ—Å–ª–µ 1,5‚Äì2 –º–µ—Å—è—Ü–µ–≤ –ª–µ—á–µ–Ω–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º–∏ –∂–µ–ª–µ–∑–∞"],
    low:["–∞–Ω–µ–º–∏—è","–¥–µ—Ñ–∏—Ü–∏—Ç B6","—Ä–µ–≤–º–∞—Ç–æ–∏–¥–Ω—ã–π –∞—Ä—Ç—Ä–∏—Ç"]
  },
  [K.PDW]: {
    high:["–æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∏–Ω—Ü–æ–º","–ø–æ—Å–ª–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏","–ø–∞—Ç–æ–ª–æ–≥–∏–∏ –ø–µ—á–µ–Ω–∏","–∫—Ä–æ–≤–æ–ø–æ—Ç–µ—Ä—è"],
    low:["–≤–∏—Ä—É—Å–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è","–¥–µ—Ñ–∏—Ü–∏—Ç B9 –∏ B12"]
  },
  [K.PLCR]: {
    high:["–ø–æ—Å–ª–µ —Ç—Ä–∞–≤–º –∏ –æ–ø–µ—Ä–∞—Ü–∏–π","–∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è (–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ/–≤–∏—Ä—É—Å–Ω—ã–µ/–≥—Ä–∏–±–∫–æ–≤—ã–µ)","–∏–Ω—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–∏ —Ö–∏–º–∏—á–µ—Å–∫–∏–º–∏ –≤–µ—â–µ—Å—Ç–≤–∞–º–∏","—Ä–µ–≤–º–∞—Ç–æ–∏–¥–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è","–°–î"],
    low:["–∏–Ω—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—è —Ç—è–∂—ë–ª—ã–º–∏ –º–µ—Ç–∞–ª–ª–∞–º–∏","–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–æ–≤ –≥—Ä—É–ø–ø—ã B","—Ç—É–±–µ—Ä–∫—É–ª—ë–∑"]
  },
  [K.BA]: {
    high:["–¥–µ—Ñ–∏—Ü–∏—Ç –∂–µ–ª–µ–∑–∞","–¥–µ—Ñ–∏—Ü–∏—Ç –≤–∏—Ç–∞–º–∏–Ω–∞ B12","–≤–∏—Ä—É—Å–Ω–∞—è/–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è","–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã","–≥–ª–∏—Å—Ç–Ω–∞—è –∏–Ω–≤–∞–∑–∏—è","–∏–Ω—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—è","–≥–∏–ø–æ—Ç–∏—Ä–µ–æ–∑"],
    low:["–¥–µ—Ñ–∏—Ü–∏—Ç B9, B12","–∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"]
  },
  [K.EO_ABS]: {
    high:["–∞–ª–ª–µ—Ä–≥–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è","–≥–ª–∏—Å—Ç–Ω–∞—è –∏–Ω–≤–∞–∑–∏—è","–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã"],
    low:["—Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ç–∏–≤–Ω–∞—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å","–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–¥–∂–µ–ª—É–¥–æ—á–Ω–æ–π –∂–µ–ª–µ–∑—ã"]
  },
  [K.NE_ABS]: {
    high:["–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è","–∏–Ω—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—è","–≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ"],
    low:["–∂–µ–ª–µ–∑–æ–¥–µ—Ñ–∏—Ü–∏—Ç","–¥–µ—Ñ–∏—Ü–∏—Ç B12, B9","–≤–∏—Ä—É—Å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞"]
  },
  [K.WBC]: {
    high:["–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã","–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏","–ø–∏—Ç–∞–Ω–∏–µ —Å –æ–±–∏–ª–∏–µ–º —É–≥–ª–µ–≤–æ–¥–æ–≤","—Å–¥–∞—á–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏"],
    low:["—Å—Ç—Ä–µ—Å—Å","–Ω–∞–¥–ø–æ—á–µ—á–Ω–∏–∫–æ–≤–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å","–≥–∏–ø–æ—Ç–∏—Ä–µ–æ–∑","–∞–Ω–µ–º–∏—è","–¥–µ—Ñ–∏—Ü–∏—Ç B12","–≤–∏—Ä—É—Å–Ω–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è"]
  },
  [K.ESR]: {
    high:["–ª—é–±—ã–µ –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è","–æ–ø—É—Ö–æ–ª–µ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã","–æ—Å—Ç—Ä–æ–µ –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—è–∂—ë–ª—ã–º–∏ –º–µ—Ç–∞–ª–ª–∞–º–∏","–º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏—è","–ø—Ä–∏—ë–º –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤"],
    low:["—ç–ø–∏–ª–µ–ø—Å–∏—è","–≥–∏–ø–æ–∞–ª—å–±—É–º–∏–Ω–µ–º–∏—è","–≥–µ–ø–∞—Ç–∏—Ç"]
  }
};

/** =========================================================
 *  4) –ö–û–ü–†–û–ì–†–ê–ú–ú–ê ‚Äî –ø–æ–ª—è
 *  ========================================================= */
const COPROGRAM_FIELDS = [
  { key:"–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è", type:"select", unit:"", options:[
    {v:"–æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π", t:"–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π, —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–∏–π (–ù–æ—Ä–º–∞)"},
    {v:"–∫–∞—à–µ–æ–±—Ä–∞–∑–Ω—ã–π", t:"–ö–∞—à–∏—Ü–µ–æ–±—Ä–∞–∑–Ω—ã–π"},
    {v:"–∂–∏–¥–∫–∏–π", t:"–ñ–∏–¥–∫–∏–π/–∫–∞—à–∏—Ü–µ–æ–±—Ä–∞–∑–Ω—ã–π (–¥–∏–∞—Ä–µ—è)"},
    {v:"—Ç–≤–µ—Ä–¥—ã–π", t:"–¢–≤—ë—Ä–¥—ã–π"},
  ]},
  { key:"–§–æ—Ä–º–∞ –ø–æ –ë—Ä–∏—Å—Ç–æ–ª—å—Å–∫–æ–π —à–∫–∞–ª–µ", type:"select", unit:"", options:[
    {v:"1", t:"–¢–∏–ø 1 ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–≤—ë—Ä–¥—ã–µ –∫–æ–º–∫–∏ (–∑–∞–ø–æ—Ä)"},
    {v:"2", t:"–¢–∏–ø 2 ‚Äî –∫–æ–ª–±–∞—Å–∫–∞ –∫–æ–º–∫–æ–≤–∞—Ç–∞—è (—Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –∑–∞–ø–æ—Ä—É)"},
    {v:"3", t:"–¢–∏–ø 3 ‚Äî –∫–æ–ª–±–∞—Å–∫–∞ —Å —Ç—Ä–µ—â–∏–Ω–∞–º–∏ (–Ω–æ—Ä–º–∞)"},
    {v:"4", t:"–¢–∏–ø 4 ‚Äî –≥–ª–∞–¥–∫–∞—è –∫–æ–ª–±–∞—Å–∫–∞/–∑–º–µ–π–∫–∞ (–Ω–æ—Ä–º–∞)"},
    {v:"5", t:"–¢–∏–ø 5 ‚Äî –º—è–≥–∫–∏–µ —à–∞—Ä–∏–∫–∏ (—Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –¥–∏–∞—Ä–µ–µ)"},
    {v:"6", t:"–¢–∏–ø 6 ‚Äî –∫–∞—à–∏—Ü–µ–æ–±—Ä–∞–∑–Ω—ã–π —Å –Ω–µ—Ä–æ–≤–Ω—ã–º–∏ –∫—Ä–∞—è–º–∏ (–¥–∏–∞—Ä–µ—è)"},
    {v:"7", t:"–¢–∏–ø 7 ‚Äî –≤–æ–¥—è–Ω–∏—Å—Ç—ã–π (—Å–∏–ª—å–Ω–∞—è –¥–∏–∞—Ä–µ—è)"},
  ]},
  { key:"–ó–∞–ø–∞—Ö", type:"select", unit:"", options:[
    {v:"–∫–∞–ª–æ–≤–∏–π", t:"–ö–∞–ª–æ–≤—ã–π, –Ω–µ—Ä–µ–∑–∫–∏–π (–ù–æ—Ä–º–∞)"},
    {v:"–∑–ª–æ–≤–æ–Ω–Ω—ã–π", t:"–ó–ª–æ–≤–æ–Ω–Ω—ã–π"},
    {v:"–∫–∏—Å–ª—ã–π", t:"–ö–∏—Å–ª—ã–π"},
  ]},
  { key:"–¶–≤–µ—Ç", type:"select", unit:"", options:[
    {v:"–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π", t:"–°–≤–µ—Ç–ª–æ-/—Ç—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π (–ù–æ—Ä–º–∞)"},
    {v:"—Ç–µ–º–Ω—ã–π", t:"–¢—ë–º–Ω—ã–π (–º–Ω–æ–≥–æ –º—è—Å–Ω–æ–≥–æ)"},
    {v:"—Å–≤–µ—Ç–ª—ã–π", t:"–°–≤–µ—Ç–ª—ã–π (–º–æ–ª–æ—á–Ω–æ-—Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ)"},
    {v:"–±–µ—Å—Ü–≤–µ—Ç–Ω—ã–π", t:"–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–≤–µ—Ç–∞"},
    {v:"–∫—Ä–∞—Å–Ω—ã–π", t:"–ö—Ä–∞—Å–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫"},
    {v:"—á–µ—Ä–Ω—ã–π", t:"–ß—ë—Ä–Ω—ã–π"},
  ]},
  { key:"–†–µ–∞–∫—Ü–∏—è pH", type:"number", unit:"pH", placeholder:"–Ω–∞–ø—Ä–∏–º–µ—Ä 6.8" },
  { key:"–°–ª–∏–∑—å", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–ù–µ—Ç (–ù–æ—Ä–º–∞)"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–û—Å—Ç–∞—Ç–∫–∏ –Ω–µ–ø–µ—Ä–µ–≤–∞—Ä–µ–Ω–Ω–æ–π –ø–∏—â–∏", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ (–Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ (–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç / –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å (–º–Ω–æ–≥–æ)"},
  ]},
  { key:"–ñ–∏—Ä –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"},
    {v:"–º–∞–ª–æ", t:"–£ –¥–µ—Ç–µ–π: –Ω–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–º–æ–∂–Ω–æ"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å (–º–Ω–æ–≥–æ)"},
  ]},
  { key:"–ñ–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ú—ã–ª–∞", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç / –Ω–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ü–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ù–µ–ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞", type:"select", unit:"", options:[
    {v:"–µ—Å—Ç—å", t:"–í –Ω–æ—Ä–º–µ ‚Äî –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ"},
    {v:"–Ω–µ—Ç", t:"–ù–µ—Ç (–ø–æ—á—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)"},
  ]},
  { key:"–í–Ω—É—Ç—Ä–∏–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–í–Ω–µ–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–î—Ä–æ–∂–∂–µ–ø–æ–¥–æ–±–Ω—ã–µ –≥—Ä–∏–±—ã", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–õ–µ–π–∫–æ—Ü–∏—Ç—ã (–∫–∞–ª)", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–ù–æ—Ä–º–∞ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ–¥–∏–Ω–∏—á–Ω—ã–µ", t:"–î–æ –≥–æ–¥–∞ ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–æ –µ–¥–∏–Ω–∏—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å (–º–Ω–æ–≥–æ)"},
  ]},
  { key:"–≠—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã (–∫–∞–ª)", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–≠–ø–∏—Ç–µ–ª–∏–π", type:"select", unit:"", options:[
    {v:"–Ω–µ–º–Ω–æ–≥–æ", t:"–í –Ω–æ—Ä–º–µ ‚Äî –Ω–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"},
    {v:"–º–Ω–æ–≥–æ", t:"–ú–Ω–æ–≥–æ"},
  ]},
  { key:"–ö–ª–æ—Å—Ç—Ä–∏–¥–∏–∏", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ô–æ–¥–æ—Ñ–∏–ª—å–Ω–∞—è —Ñ–ª–æ—Ä–∞", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"},
    {v:"–µ—Å—Ç—å", t:"–ï—Å—Ç—å"},
  ]},
  { key:"–ö—Ä–∏—Å—Ç–∞–ª–ª—ã", type:"select", unit:"", options:[
    {v:"–Ω–µ—Ç", t:"–í –Ω–æ—Ä–º–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"},
    {v:"—Ç—Ä–∏–ø–µ–ª—å—Ñ–æ—Å—Ñ–∞—Ç—ã", t:"–¢—Ä–∏–ø–µ–ª—å—Ñ–æ—Å—Ñ–∞—Ç—ã"},
    {v:"–¥—Ä—É–≥–æ–µ", t:"–î—Ä—É–≥–∏–µ"},
  ]},
];

/** =========================================================
 *  5) –ü—Ä–∞–≤–∏–ª–∞/—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∫–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã
 *  ========================================================= */
const COPROGRAM_RULES = {
  "–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è": { norm: ["–æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π"], explain: {
    "–∫–∞—à–µ–æ–±—Ä–∞–∑–Ω—ã–π": "–ß–∞—Å—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –±–æ–ª—å—à–∏–º –æ–±—ä—ë–º–æ–º —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–π –ø–∏—â–∏/–∫–ª–µ—Ç—á–∞—Ç–∫–∏ (—É—Å–∏–ª–µ–Ω–∏–µ –ø–µ—Ä–∏—Å—Ç–∞–ª—å—Ç–∏–∫–∏).",
    "–∂–∏–¥–∫–∏–π": "–î–∏–∞—Ä–µ—è: –º–Ω–æ–≥–æ –≤–æ–¥—ã (–¥–æ 85% –∏ –±–æ–ª–µ–µ), —É—á–∞—â–µ–Ω–∏–µ —Å—Ç—É–ª–∞.",
    "—Ç–≤–µ—Ä–¥—ã–π": "–ó–∞–ø–æ—Ä, –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è, –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ –∫–∞–ª–∞ (–≤–æ–¥–∞ < 50‚Äì60%)."
  }},
  "–§–æ—Ä–º–∞ –ø–æ –ë—Ä–∏—Å—Ç–æ–ª—å—Å–∫–æ–π —à–∫–∞–ª–µ": { norm: ["3","4"], explain: {
    "1":"–ó–∞–ø–æ—Ä.","2":"–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –∑–∞–ø–æ—Ä—É.","5":"–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –¥–∏–∞—Ä–µ–µ.","6":"–î–∏–∞—Ä–µ—è.","7":"–°–∏–ª—å–Ω–∞—è –¥–∏–∞—Ä–µ—è."
  }},
  "–ó–∞–ø–∞—Ö": { norm: ["–∫–∞–ª–æ–≤–∏–π"], explain: {
    "–∑–ª–æ–≤–æ–Ω–Ω—ã–π":"–ì–Ω–∏–ª–æ—Å—Ç–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–∏—à–µ—á–Ω–∏–∫–µ.",
    "–∫–∏—Å–ª—ã–π":"–£—Å–∏–ª–µ–Ω–∏–µ –±—Ä–æ–∂–µ–Ω–∏—è / –∏–Ω—Ñ–µ–∫—Ü–∏—è / —Å–±–æ–π —Ñ–µ—Ä–º–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (—É–≥–ª–µ–≤–æ–¥—ã)."
  }},
  "–¶–≤–µ—Ç": {
    norm: ["–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π","—Ç–µ–º–Ω—ã–π","—Å–≤–µ—Ç–ª—ã–π"],
    warn: ["—Ç–µ–º–Ω—ã–π","—Å–≤–µ—Ç–ª—ã–π"],
    explain: {
      "—Ç–µ–º–Ω—ã–π":"–ß–∞—â–µ ‚Äî —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º—è—Å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤.",
      "—Å–≤–µ—Ç–ª—ã–π":"–ß–∞—â–µ ‚Äî –º–æ–ª–æ—á–Ω–æ-—Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ.",
      "–±–µ—Å—Ü–≤–µ—Ç–Ω—ã–π":"–ó–∞–∫—É–ø–æ—Ä–∫–∞ –∂–µ–ª—á–µ–≤—ã–≤–æ–¥—è—â–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–≤ –∏–ª–∏ —Å–±–æ–π —Ä–∞–±–æ—Ç—ã –ø–µ—á–µ–Ω–∏.",
      "–∫—Ä–∞—Å–Ω—ã–π":"–í–æ–∑–º–æ–∂–Ω–æ–µ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –Ω–∏–∂–Ω–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ –ñ–ö–¢.",
      "—á–µ—Ä–Ω—ã–π":"–í–æ–∑–º–æ–∂–Ω–æ–µ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –≤–µ—Ä—Ö–Ω–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ –ñ–ö–¢ (–æ–∫–∏—Å–ª–µ–Ω–∏–µ –≥–µ–º–æ–≥–ª–æ–±–∏–Ω–∞)."
    }
  },
  "–†–µ–∞–∫—Ü–∏—è pH": {
    explainLow: "–°–¥–≤–∏–≥ –≤ –∫–∏—Å–ª—É—é —Å—Ç–æ—Ä–æ–Ω—É: –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–∞–∫—Ç–µ—Ä–∏–π/–±—Ä–æ–∂–µ–Ω–∏–µ.",
    explainHigh: "–°–¥–≤–∏–≥ –≤ —â–µ–ª–æ—á–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É (–±–ª–∏–∂–µ –∫ 8): –º–æ–∂–µ—Ç –±—ã—Ç—å –≥–∏–ø–µ—Ä–∞–º–º–æ–Ω–∏–µ–º–∏—è/—Å–Ω–∏–∂–µ–Ω–∏–µ –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç–∏."
  },
  "–°–ª–∏–∑—å": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –≤ –∫–∏—à–µ—á–Ω–∏–∫–µ." } },
  "–û—Å—Ç–∞—Ç–∫–∏ –Ω–µ–ø–µ—Ä–µ–≤–∞—Ä–µ–Ω–Ω–æ–π –ø–∏—â–∏": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –∂–µ–ª—É–¥–æ—á–Ω–æ–≥–æ —Å–æ–∫–∞/–∂–µ–ª—á–∏ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∏—â–∏."} },
  "–ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ (–Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –∂–µ–ª—É–¥–æ—á–Ω–æ–≥–æ —Å–æ–∫–∞ (–Ω–∏–∑–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è —Å–æ–ª—è–Ω–æ–π –∫–∏—Å–ª–æ—Ç—ã)."} },
  "–ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ (–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–£—Ö—É–¥—à–µ–Ω–∏–µ —Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏—è –±–µ–ª–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –∂–µ–ª—É–¥–æ—á–Ω–æ–≥–æ —Å–æ–∫–∞/–Ω–∏–∑–∫–∞—è –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å."} },
  "–ñ–∏—Ä –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π": { norm:["–Ω–µ—Ç","–º–∞–ª–æ"], explain:{ "–µ—Å—Ç—å":"–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–∂–µ–ª—É–¥–æ—á–Ω–æ–π –∂–µ–ª–µ–∑—ã –∏/–∏–ª–∏ –∂–µ–ª—á–µ–æ—Ç—Ç–æ–∫–∞; –Ω–∞—Ä—É—à–µ–Ω–∏–µ —É—Å–≤–æ–µ–Ω–∏—è –∂–∏—Ä–æ–≤."} },
  "–ñ–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ü—Ä–æ–¥—É–∫—Ç—ã —Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏—è –∂–∏—Ä–æ–≤; –Ω–∞–ª–∏—á–∏–µ ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π —É—Å–≤–æ–µ–Ω–∏—è/—Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏—è –∂–∏—Ä–æ–≤."} },
  "–ú—ã–ª–∞": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–í–∏–¥–æ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –∂–∏—Ä–æ–≤; –ø—Ä–∏–∑–Ω–∞–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π —É—Å–≤–æ–µ–Ω–∏—è/—Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏—è –∂–∏—Ä–æ–≤."} },
  "–ü–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Å–æ–ª—è–Ω–æ–π –∫–∏—Å–ª–æ—Ç—ã; —É—Å–∏–ª–µ–Ω–∏–µ –≥–Ω–∏–ª–æ—Å—Ç–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤; –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è."} },
  "–ù–µ–ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞": { norm:["–µ—Å—Ç—å"], explain:{ "–Ω–µ—Ç":"–ï—Å–ª–∏ –ø–æ—á—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∏—Ç–∞–Ω–∏—è/–º–∞–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–π –ø–∏—â–∏." } },
  "–í–Ω—É—Ç—Ä–∏–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —Å–µ–∫—Ä–µ—Ü–∏–∏ –∂–µ–ª—É–¥–æ—á–Ω–æ–≥–æ —Å–æ–∫–∞ –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è."} },
  "–í–Ω–µ–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ñ–µ—Ä–º–µ–Ω—Ç–æ–≤ (–∞–º–∏–ª–∞–∑–∞) –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –ø–∏—â–∏ –ø–æ –∫–∏—à–µ—á–Ω–∏–∫—É."} },
  "–î—Ä–æ–∂–∂–µ–ø–æ–¥–æ–±–Ω—ã–µ –≥—Ä–∏–±—ã": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: –ø–æ—Å–ª–µ –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–æ–≤, –∏–∑–±—ã—Ç–æ–∫ —Å–ª–∞–¥–∫–æ–≥–æ/—É–≥–ª–µ–≤–æ–¥–æ–≤, —Å–Ω–∏–∂–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞, –ø–∞—Ä–∞–∑–∏—Ç–∞—Ä–Ω–∞—è –∏–Ω–≤–∞–∑–∏—è."} },
  "–õ–µ–π–∫–æ—Ü–∏—Ç—ã (–∫–∞–ª)": { norm:["–Ω–µ—Ç"], explain:{ "–µ–¥–∏–Ω–∏—á–Ω—ã–µ":"–î–æ –≥–æ–¥–∞ ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–æ –µ–¥–∏–Ω–∏—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.","–µ—Å—Ç—å":"–ü—Ä–∏–∑–Ω–∞–∫ –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ/–∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –ñ–ö–¢." } },
  "–≠—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã (–∫–∞–ª)": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: —ç—Ä–æ–∑–∏–∏/—è–∑–≤—ã/—Ç—Ä–µ—â–∏–Ω—ã —Å–ª–∏–∑–∏—Å—Ç–æ–π, –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è, –∞–ª–ª–µ—Ä–≥–∏–∏."} },
  "–≠–ø–∏—Ç–µ–ª–∏–π": { norm:["–Ω–µ–º–Ω–æ–≥–æ"], explain:{ "–º–Ω–æ–≥–æ":"–ú–Ω–æ–≥–æ ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è –∫–∏—à–µ—á–Ω–æ–π —Å—Ç–µ–Ω–∫–∏."} },
  "–ö–ª–æ—Å—Ç—Ä–∏–¥–∏–∏": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ü—Ä–∏–∑–Ω–∞–∫ –≥–Ω–∏–µ–Ω–∏—è (–Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏–∏ –±–µ–ª–∫–∞)."} },
  "–ô–æ–¥–æ—Ñ–∏–ª—å–Ω–∞—è —Ñ–ª–æ—Ä–∞": { norm:["–Ω–µ—Ç"], explain:{ "–µ—Å—Ç—å":"–ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏ –±—Ä–æ–¥–∏–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö/–¥–∏—Å–±–∏–æ–∑–µ."} },
  "–ö—Ä–∏—Å—Ç–∞–ª–ª—ã": { norm:["–Ω–µ—Ç"], explain:{
    "—Ç—Ä–∏–ø–µ–ª—å—Ñ–æ—Å—Ñ–∞—Ç—ã":"–¢—Ä–∏–ø–µ–ª—å—Ñ–æ—Å—Ñ–∞—Ç—ã ‚Äî –≤ —Ä–µ–∑–∫–æ —â–µ–ª–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≥–Ω–∏–ª–æ—Å—Ç–Ω—ã—Ö –±–∞–∫—Ç–µ—Ä–∏–π). –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞—Ç–æ–ª–æ–≥–∏–∏ ‚Äî –ª—É—á—à–µ –∫ –≤—Ä–∞—á—É.",
    "–¥—Ä—É–≥–æ–µ":"–ö—Ä–∏—Å—Ç–∞–ª–ª—ã –≤ –Ω–æ—Ä–º–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–∞—Ç–æ–ª–æ–≥–∏–∏."
  }},
};

/** =========================================================
 *  6) UI refs
 *  ========================================================= */
const els = {
  analysisType: document.getElementById("analysisType"),
  ageBox: document.getElementById("ageBox"),
  age: document.getElementById("age"),
  sex: document.getElementById("sex"),
  agePill: document.getElementById("agePill"),

  inputTitle: document.getElementById("inputTitle"),
  inputHint: document.getElementById("inputHint"),
  hdrRow: document.getElementById("hdrRow"),
  inputs: document.getElementById("inputs"),

  checkBtn: document.getElementById("checkBtn"),
  fillDemoBtn: document.getElementById("fillDemoBtn"),
  clearBtn: document.getElementById("clearBtn"),
  csvBtn: document.getElementById("csvBtn"),

  report: document.getElementById("report"),
  error: document.getElementById("error"),
};

let lastReportRows = [];

/** =========================================================
 *  Helpers
 *  ========================================================= */
function clampAge(a){
  if (Number.isNaN(a)) return 0;
  return Math.min(18, Math.max(0, a));
}
function setBandPill(){
  const type = els.analysisType.value;
  const age = clampAge(parseFloat(els.age.value));
  els.agePill.textContent = (type === "blood")
    ? `–ö—Ä–æ–≤—å ‚Ä¢ –≤–æ–∑—Ä–∞—Å—Ç: ${age} –ª–µ—Ç`
    : `–ö–æ–ø—Ä–æ–≥—Ä–∞–º–º–∞ ‚Ä¢ –≤–æ–∑—Ä–∞—Å—Ç: ${age} –ª–µ—Ç`;
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, (m)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
  }[m]));
}
function statusClass(st){
  if (st.includes("‚úÖ")) return "s-ok";
  if (st.includes("üî∫")) return "s-hi";
  if (st.includes("üîª")) return "s-lo";
  return "s-warn";
}
function parseNum(val){
  if (val == null) return null;
  const s = String(val).trim();
  if (!s) return null;
  const normalized = s.replace(",", ".").replace(/\s+/g,"");
  const num = Number(normalized);
  return Number.isFinite(num) ? num : null;
}
function pickNorm(indicatorKey, ageYears, sex){
  const rules = BLOOD_NORMS[indicatorKey];
  if (!rules) return null;
  const a = clampAge(ageYears);

  if (!sex) return rules.find(r => !r.sex && a >= r.a0 && a < r.a1) || rules.find(r => a >= r.a0 && a < r.a1) || null;

  const sexRule = rules.find(r => r.sex === sex && a >= r.a0 && a < r.a1);
  if (sexRule) return sexRule;
  return rules.find(r => !r.sex && a >= r.a0 && a < r.a1) || rules.find(r => a >= r.a0 && a < r.a1) || null;
}
function renderReasonList(title, items){
  if (!items || !items.length) return "";
  return `<div class="mini"><b>${escapeHtml(title)}:</b><ul>${items.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul></div>`;
}
function getInputValueByKey(key){
  const el = document.querySelector(`[data-key="${CSS.escape(key)}"]`);
  if (!el) return null;
  if (el.tagName.toLowerCase()==="select") return el.value || "";
  return el.value || "";
}

/** =========================================================
 *  Render inputs by type (–û–î–ò–ù –°–¢–û–õ–ë–ï–¶ + –µ–¥–∏–Ω–∏—Ü—ã –Ω–∞–ø—Ä–æ—Ç–∏–≤ –Ω–∞–∑–≤–∞–Ω–∏—è)
 *  ========================================================= */
function buildInputs(){
  els.inputs.innerHTML = "";
  lastReportRows = [];
  els.report.innerHTML = "–ó–∞–ø–æ–ª–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏ ‚Äú–ü—Ä–æ–≤–µ—Ä–∏—Ç—å‚Äù.";
  els.error.textContent = "";

  const type = els.analysisType.value;

  els.hdrRow.classList.remove("hidden");
  els.ageBox.classList.remove("hidden");

  if (type === "blood"){
    els.inputTitle.textContent = "–í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ö—Ä–æ–≤—å)";
    els.inputHint.textContent = "–í–ø–∏—à–∏ —á–∏—Å–ª–∞. –ú–æ–∂–Ω–æ —Å –∑–∞–ø—è—Ç–æ–π –∏–ª–∏ —Ç–æ—á–∫–æ–π.";
    els.sex.parentElement.classList.remove("hidden");

    for (const it of BLOOD_INDICATORS){
      const row = document.createElement("div");
      row.innerHTML = `
        <div class="field-head">
          <b>${escapeHtml(it.key)}</b>
          <span class="field-unit">${escapeHtml(it.unit)}</span>
        </div>
        <div class="mini">–Ω–æ—Ä–º–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É</div>
        <input class="value" data-key="${escapeHtml(it.key)}" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" />
      `;
      els.inputs.appendChild(row);
    }

  } else {
    els.inputTitle.textContent = "–í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ö–æ–ø—Ä–æ–≥—Ä–∞–º–º–∞)";
    els.inputHint.textContent = "–í—ã–±–µ—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏/–∏–ª–∏ –≤–≤–µ–¥–∏ pH. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ ‚Äî –≤ –æ—Ç—á—ë—Ç–µ.";
    els.sex.parentElement.classList.add("hidden");

    for (const f of COPROGRAM_FIELDS){
      const row = document.createElement("div");
      let inputHtml = "";

      if (f.type === "select"){
        inputHtml = `<select class="value" data-key="${escapeHtml(f.key)}">
          <option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å ‚Äî</option>
          ${f.options.map(o=>`<option value="${escapeHtml(o.v)}">${escapeHtml(o.t)}</option>`).join("")}
        </select>`;
      } else {
        inputHtml = `<input class="value" data-key="${escapeHtml(f.key)}" type="text" placeholder="${escapeHtml(f.placeholder || "‚Äî")}" />`;
      }

      const unitSpan = f.unit ? `<span class="field-unit">${escapeHtml(f.unit)}</span>` : `<span></span>`;

      row.innerHTML = `
        <div class="field-head">
          <b>${escapeHtml(f.key)}</b>
          ${unitSpan}
        </div>
        <div class="mini">–∫–æ–ø—Ä–æ–≥—Ä–∞–º–º–∞</div>
        ${inputHtml}
      `;
      els.inputs.appendChild(row);
    }
  }

  setBandPill();
}

/** =========================================================
 *  ‚Äú–ü–∞–º—è—Ç–∫–∏‚Äù (–∫–∞–∫ —É —Ç–µ–±—è –±—ã–ª–æ)
 *  ========================================================= */
function buildBloodMemo(){
  const wbc = parseNum(getInputValueByKey(K.WBC));
  const ne = parseNum(getInputValueByKey(K.NE_ABS));
  const ly = parseNum(getInputValueByKey(K.LY_PCT));
  const mo = parseNum(getInputValueByKey(K.MO_PCT));
  const hgb = parseNum(getInputValueByKey(K.HGB));
  const rbc = parseNum(getInputValueByKey(K.RBC));
  const hct = parseNum(getInputValueByKey(K.HCT));
  const mcv = parseNum(getInputValueByKey(K.MCV));
  const mch = parseNum(getInputValueByKey(K.MCH));
  const mchc = parseNum(getInputValueByKey(K.MCHC));
  const plt = parseNum(getInputValueByKey(K.PLT));

  const notes = [];
  if (ne != null && ly != null){
    notes.push("–ï—Å–ª–∏ –Ω–µ–π—Ç—Ä–æ—Ñ–∏–ª—ã –≤—ã—Å–æ–∫–∏–µ, –∞ –ª–∏–º—Ñ–æ—Ü–∏—Ç—ã –Ω–∏–∑–∫–∏–µ ‚Äî —á–∞—Å—Ç–æ —ç—Ç–æ –±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä-–ø–∞–º—è—Ç–∫–∞).");
  }
  if (hgb != null && rbc != null && hct != null){
    notes.push("–í—ã—Å–æ–∫–∏–µ –≥–µ–º–æ–≥–ª–æ–±–∏–Ω+—ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã+–≥–µ–º–∞—Ç–æ–∫—Ä–∏—Ç –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞ —Ñ–æ–Ω–µ –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏—è/–∏–Ω—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–∏ (–ø–æ –ø–∞–º—è—Ç–∫–µ).");
    notes.push("–ù–∏–∑–∫–∏–µ –≥–µ–º–æ–≥–ª–æ–±–∏–Ω+—ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã+–≥–µ–º–∞—Ç–æ–∫—Ä–∏—Ç: —á–∞—Å—Ç–æ –∞–Ω–µ–º–∏–∏/–∫—Ä–æ–≤–æ–ø–æ—Ç–µ—Ä–∏; –ø–æ–ª–µ–∑–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å MCV/MCH/MCHC.");
  }
  if (mcv != null && mch != null && mchc != null){
    notes.push("–ï—Å–ª–∏ —ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç–∞—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (MCV/MCH/MCHC) –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã ‚Äî —á–∞—Å—Ç–æ –¥–µ—Ñ–∏—Ü–∏—Ç—ã (–∂–µ–ª–µ–∑–æ, B9, B12 –∏ –¥—Ä.) –ø–æ –ø–∞–º—è—Ç–∫–µ.");
  }
  if (plt != null){
    notes.push("–ü–æ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–æ–º–±–æ—Ü–∏—Ç–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏ –≤–æ—Å–ø–∞–ª–µ–Ω–∏–∏/–≤–∏—Ä—É—Å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (–ø–æ –ø–∞–º—è—Ç–∫–µ).");
  }
  if (wbc != null && wbc < 2){
    notes.push("–í—ã—Ä–∞–∂–µ–Ω–Ω–æ –Ω–∏–∑–∫–∏–µ –ª–µ–π–∫–æ—Ü–∏—Ç—ã ‚Äî –ø–æ–≤–æ–¥ –æ–±—Å—É–¥–∏—Ç—å —Å –≤—Ä–∞—á–æ–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.");
  }

  if (!notes.length) return "";
  return `<div class="memo"><b>–ü–∞–º—è—Ç–∫–∞ (–û–ê–ö):</b><div class="mini"><ul>${notes.map(n=>`<li>${escapeHtml(n)}</li>`).join("")}</ul></div></div>`;
}

function buildCoprogramMemo(){
  const fatAcids = getInputValueByKey("–ñ–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã");
  const neutralFat = getInputValueByKey("–ñ–∏—Ä –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π");
  const soap = getInputValueByKey("–ú—ã–ª–∞");
  const fiber = getInputValueByKey("–ü–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞");
  const iod = getInputValueByKey("–ô–æ–¥–æ—Ñ–∏–ª—å–Ω–∞—è —Ñ–ª–æ—Ä–∞");
  const starch = getInputValueByKey("–í–Ω—É—Ç—Ä–∏–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª");
  const color = getInputValueByKey("–¶–≤–µ—Ç");

  const notes = [];
  if ((fatAcids==="–µ—Å—Ç—å" || neutralFat==="–µ—Å—Ç—å" || soap==="–µ—Å—Ç—å")){
    notes.push("–ñ–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –∂–∏—Ä/–º—ã–ª–∞ ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —É—Å–≤–æ–µ–Ω–∏—è –∂–∏—Ä–æ–≤, —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∂–µ–ª—á–µ–æ—Ç—Ç–æ–∫.");
  }
  if ((fatAcids==="–µ—Å—Ç—å" || neutralFat==="–µ—Å—Ç—å" || soap==="–µ—Å—Ç—å") && (fiber==="–µ—Å—Ç—å" || iod==="–µ—Å—Ç—å")){
    notes.push("–ñ–∏—Ä—ã + –ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞/–π–æ–¥–æ—Ñ–∏–ª—å–Ω–∞—è —Ñ–ª–æ—Ä–∞ ‚Üí –≤–æ–∑–º–æ–∂–µ–Ω —Å–∏–Ω–¥—Ä–æ–º –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ (–ø–æ –ø–∞–º—è—Ç–∫–µ).");
  }
  if (starch==="–µ—Å—Ç—å"){
    notes.push("–ö—Ä–∞—Ö–º–∞–ª ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞ —Å–ª–∞–±–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ñ–µ—Ä–º–µ–Ω—Ç–æ–≤ –ø–æ–¥–∂–µ–ª—É–¥–æ—á–Ω–æ–π (–ø–æ –ø–∞–º—è—Ç–∫–µ).");
  }
  if (color==="–±–µ—Å—Ü–≤–µ—Ç–Ω—ã–π"){
    notes.push("–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–≤–µ—Ç–∞ ‚Üí –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∂–µ–ª—á—å—é/–ø–µ—á–µ–Ω—å—é (–æ–±—Å—É–¥–∏—Ç—å —Å –≤—Ä–∞—á–æ–º).");
  }
  if (color==="–∫—Ä–∞—Å–Ω—ã–π"){
    notes.push("–ö—Ä–∞—Å–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è –Ω–∏–∂–Ω–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ –ñ–ö–¢ (–æ–±—Å—É–¥–∏—Ç—å —Å –≤—Ä–∞—á–æ–º).");
  }
  if (color==="—á–µ—Ä–Ω—ã–π"){
    notes.push("–ß—ë—Ä–Ω—ã–π —Ü–≤–µ—Ç ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è –≤–µ—Ä—Ö–Ω–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ –ñ–ö–¢ (–æ–±—Å—É–¥–∏—Ç—å —Å –≤—Ä–∞—á–æ–º).");
  }

  if (!notes.length) return "";
  return `<div class="memo"><b>–ü–∞–º—è—Ç–∫–∞ (–∫–æ–ø—Ä–æ–≥—Ä–∞–º–º–∞):</b><div class="mini"><ul>${notes.map(n=>`<li>${escapeHtml(n)}</li>`).join("")}</ul></div></div>`;
}

/** =========================================================
 *  Evaluate blood
 *  ========================================================= */
function evaluateBlood(){
  const age = clampAge(parseFloat(els.age.value));
  const sex = els.sex.value;
  const sexKey = (sex === "any") ? "" : sex;

  const inputs = [...document.querySelectorAll('[data-key]')];
  const rows = [];

  for (const input of inputs){
    const name = input.dataset.key;
    const val = parseNum(input.value);

    const unit = BLOOD_INDICATORS.find(x=>x.key===name)?.unit || "";
    const norm = pickNorm(name, age, sexKey);

    let normText = "‚Äî";
    let status = "‚Äî";
    let reasonHtml = "";

    if (val == null){
      status = "‚Äî";
    } else if (!norm || norm.min == null || norm.max == null){
      status = "‚ö†Ô∏è –Ω–æ—Ä–º–∞ –Ω–µ –∑–∞–¥–∞–Ω–∞";
    } else {
      normText = `${norm.min}‚Äì${norm.max} (${norm.label})`;
      if (val < norm.min){
        status = "üîª –Ω–∏–∂–µ –Ω–æ—Ä–º—ã";
        const rr = BLOOD_REASONS[name]?.low || [];
        reasonHtml = renderReasonList("–ü—Ä–∏—á–∏–Ω—ã –ø–æ–Ω–∏–∂–µ–Ω–∏—è", rr);
      } else if (val > norm.max){
        status = "üî∫ –≤—ã—à–µ –Ω–æ—Ä–º—ã";
        const rr = BLOOD_REASONS[name]?.high || [];
        reasonHtml = renderReasonList("–ü—Ä–∏—á–∏–Ω—ã –ø–æ–≤—ã—à–µ–Ω–∏—è", rr);
      } else {
        status = "‚úÖ –Ω–æ—Ä–º–∞";
      }
    }

    rows.push({ name, value: (val == null ? "" : val), unit, normText, status, reasonHtml });
  }

  lastReportRows = rows;
  renderReport(rows, "blood");
}

/** =========================================================
 *  Evaluate coprogram
 *  ========================================================= */
function evaluateCoprogram(){
  const inputs = [...document.querySelectorAll('[data-key]')];
  const rows = [];

  for (const input of inputs){
    const name = input.dataset.key;
    const raw = (input.tagName.toLowerCase()==="select") ? input.value : input.value.trim();

    let status = "‚Äî";
    let normText = "‚Äî";
    let reasonHtml = "";

    const rule = COPROGRAM_RULES[name];

    if (!raw){
      status = "‚Äî";
    } else if (!rule){
      status = "‚ö†Ô∏è –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –∑–∞–¥–∞–Ω–æ";
    } else if (name === "–†–µ–∞–∫—Ü–∏—è pH"){
      const val = parseNum(raw);
      const age = clampAge(parseFloat(els.age.value || "6"));
      if (val == null){
        status = "‚ö†Ô∏è –Ω–µ–≤–µ—Ä–Ω–æ–µ —á–∏—Å–ª–æ";
      } else {
        if (age < 1){
          normText = `0‚Äì1 –≥–æ–¥: 4.8‚Äì5.8 (–ì–í) –∏–ª–∏ 6.8‚Äì7.0 (–ò–í)`;
          const ok = (val>=4.8 && val<=5.8) || (val>=6.8 && val<=7.0);
          if (ok){
            status = "‚úÖ –Ω–æ—Ä–º–∞";
          } else if (val < 4.8){
            status = "üîª –Ω–∏–∂–µ –Ω–æ—Ä–º—ã";
            reasonHtml = `<div class="mini">${escapeHtml(rule.explainLow)}</div>`;
          } else if (val > 7.0){
            status = "üî∫ –≤—ã—à–µ –Ω–æ—Ä–º—ã";
            reasonHtml = `<div class="mini">${escapeHtml(rule.explainHigh)}</div>`;
          } else {
            status = "‚ö†Ô∏è –≤–Ω–µ –Ω–æ—Ä–º—ã";
            reasonHtml = `<div class="mini">pH –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω –ì–í, –Ω–∏ –ò–í (–ø–æ –ø–∞–º—è—Ç–∫–µ).</div>`;
          }
        } else {
          normText = `—Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞: 6.0‚Äì8.0`;
          if (val < 6.0){
            status = "üîª –Ω–∏–∂–µ –Ω–æ—Ä–º—ã";
            reasonHtml = `<div class="mini">${escapeHtml(rule.explainLow)}</div>`;
          } else if (val > 8.0){
            status = "üî∫ –≤—ã—à–µ –Ω–æ—Ä–º—ã";
            reasonHtml = `<div class="mini">${escapeHtml(rule.explainHigh)}</div>`;
          } else {
            status = "‚úÖ –Ω–æ—Ä–º–∞";
          }
        }
      }
    } else {
      const norms = rule.norm || [];
      const warn = rule.warn || [];
      normText = norms.length ? norms.join(", ") : "‚Äî";

      if (norms.includes(raw)){
        if (warn.includes(raw)){
          status = "‚ö†Ô∏è –≤–∞—Ä–∏–∞–Ω—Ç –Ω–æ—Ä–º—ã";
          const txt = rule.explain?.[raw] || "";
          reasonHtml = txt ? `<div class="mini">${escapeHtml(txt)}</div>` : "";
        } else {
          status = "‚úÖ –Ω–æ—Ä–º–∞";
        }
      } else {
        status = "üî∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ";
        const txt = rule.explain?.[raw] || "–ï—Å—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –Ω–æ—Ä–º—ã –ø–æ –ø–∞–º—è—Ç–∫–µ.";
        reasonHtml = `<div class="mini">${escapeHtml(txt)}</div>`;
      }
    }

    rows.push({ name, value: raw, unit: "", normText, status, reasonHtml });
  }

  lastReportRows = rows;
  renderReport(rows, "coprogram");
}

function renderReport(rows, type){
  const headerNorm = (type==="blood") ? "–ù–æ—Ä–º–∞" : "–ù–æ—Ä–º–∞/–æ–∂–∏–¥–∞–Ω–∏–µ";
  const memoHtml = (type==="blood") ? buildBloodMemo() : buildCoprogramMemo();

  const html = `
    ${memoHtml}
    <table class="table">
      <thead>
        <tr>
          <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
          <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
          <th>–ï–¥.</th>
          <th>${headerNorm}</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ü–æ—è—Å–Ω–µ–Ω–∏–µ</th>
        </tr>
      </thead>
      <tbody>
        ${rows.map(r=>{
          const stClass = statusClass(r.status);
          const reasonBlock = r.reasonHtml
            ? `<details><summary>–ø–æ–∫–∞–∑–∞—Ç—å</summary>${r.reasonHtml}</details>`
            : `<span class="mut">‚Äî</span>`;

          return `
            <tr>
              <td><b>${escapeHtml(r.name)}</b></td>
              <td>${escapeHtml(r.value)}</td>
              <td>${escapeHtml(r.unit || "")}</td>
              <td>${escapeHtml(r.normText || "‚Äî")}</td>
              <td class="${stClass}">${escapeHtml(r.status)}</td>
              <td>${reasonBlock}</td>
            </tr>
          `;
        }).join("")}
      </tbody>
    </table>
  `;

  els.report.innerHTML = html;
}

/** =========================================================
 *  CSV download (UTF-8 + BOM)
 *  ========================================================= */
function downloadCSV(){
  if (!lastReportRows.length){
    els.error.textContent = "‚úñÔ∏è –°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ ‚Äú–ü—Ä–æ–≤–µ—Ä–∏—Ç—å‚Äù, —á—Ç–æ–±—ã –ø–æ—è–≤–∏–ª—Å—è –æ—Ç—á—ë—Ç.";
    return;
  }
  const header = ["–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å","–ó–Ω–∞—á–µ–Ω–∏–µ","–ï–¥.","–ù–æ—Ä–º–∞","–°—Ç–∞—Ç—É—Å","–ü–æ—è—Å–Ω–µ–Ω–∏–µ"];
  const lines = [header.join(";")].concat(
    lastReportRows.map(r => [
      r.name, r.value ?? "", r.unit ?? "", r.normText ?? "", r.status ?? "", ""
    ].map(x => String(x).replaceAll(";", ",")).join(";"))
  );

  const bom = "\uFEFF";
  const blob = new Blob([bom + lines.join("\n")], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "report.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/** =========================================================
 *  Actions
 *  ========================================================= */
function clearAll(){
  for (const el of document.querySelectorAll('[data-key]')){
    if (el.tagName.toLowerCase()==="select") el.value = "";
    else el.value = "";
  }
  els.report.innerHTML = "–ó–∞–ø–æ–ª–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏ ‚Äú–ü—Ä–æ–≤–µ—Ä–∏—Ç—å‚Äù.";
  els.error.textContent = "";
  lastReportRows = [];
}

function fillExample(){
  const type = els.analysisType.value;

  if (type === "blood"){
    els.age.value = 6;
    els.sex.value = "any";
    const demo = {
      [K.WBC]:"6,1",
      [K.RBC]:"4,6",
      [K.HGB]:"112",
      [K.HCT]:"34",
      [K.PLT]:"420",
      [K.PDW]:"13",
      [K.PLCR]:"54",
      [K.PCT]:"0,30",
      [K.ESR]:"6"
    };
    applyValues(demo);
  } else {
    const demo = {
      "–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è":"–æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π",
      "–§–æ—Ä–º–∞ –ø–æ –ë—Ä–∏—Å—Ç–æ–ª—å—Å–∫–æ–π —à–∫–∞–ª–µ":"4",
      "–ó–∞–ø–∞—Ö":"–∫–∞–ª–æ–≤–∏–π",
      "–¶–≤–µ—Ç":"–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π",
      "–†–µ–∞–∫—Ü–∏—è pH":"7.0",
      "–°–ª–∏–∑—å":"–Ω–µ—Ç",
      "–û—Å—Ç–∞—Ç–∫–∏ –Ω–µ–ø–µ—Ä–µ–≤–∞—Ä–µ–Ω–Ω–æ–π –ø–∏—â–∏":"–Ω–µ—Ç",
      "–ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ (–Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)":"–Ω–µ—Ç",
      "–ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ (–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ)":"–Ω–µ—Ç",
      "–ñ–∏—Ä –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π":"–Ω–µ—Ç",
      "–ñ–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã":"–Ω–µ—Ç",
      "–ú—ã–ª–∞":"–Ω–µ—Ç",
      "–ü–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞":"–Ω–µ—Ç",
      "–ù–µ–ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ–º–∞—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞":"–µ—Å—Ç—å",
      "–í–Ω—É—Ç—Ä–∏–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª":"–Ω–µ—Ç",
      "–í–Ω–µ–∫–ª–µ—Ç–æ—á–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª":"–Ω–µ—Ç",
      "–î—Ä–æ–∂–∂–µ–ø–æ–¥–æ–±–Ω—ã–µ –≥—Ä–∏–±—ã":"–Ω–µ—Ç",
      "–õ–µ–π–∫–æ—Ü–∏—Ç—ã (–∫–∞–ª)":"–Ω–µ—Ç",
      "–≠—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã (–∫–∞–ª)":"–Ω–µ—Ç",
      "–≠–ø–∏—Ç–µ–ª–∏–π":"–Ω–µ–º–Ω–æ–≥–æ",
      "–ö–ª–æ—Å—Ç—Ä–∏–¥–∏–∏":"–Ω–µ—Ç",
      "–ô–æ–¥–æ—Ñ–∏–ª—å–Ω–∞—è —Ñ–ª–æ—Ä–∞":"–Ω–µ—Ç",
      "–ö—Ä–∏—Å—Ç–∞–ª–ª—ã":"–Ω–µ—Ç"
    };
    applyValues(demo);
  }

  setBandPill();
}

function applyValues(values){
  for (const el of document.querySelectorAll('[data-key]')){
    const k = el.dataset.key;
    if (!(k in values)) continue;
    el.value = String(values[k]);
  }
}

function onCheck(){
  els.error.textContent = "";
  const type = els.analysisType.value;
  if (type==="blood") evaluateBlood();
  else evaluateCoprogram();
}

/** =========================================================
 *  Init + events
 *  ========================================================= */
els.analysisType.addEventListener("change", buildInputs);
els.age.addEventListener("input", setBandPill);
els.sex.addEventListener("change", setBandPill);

els.checkBtn.addEventListener("click", onCheck);
els.fillDemoBtn.addEventListener("click", fillExample);
els.clearBtn.addEventListener("click", clearAll);
els.csvBtn.addEventListener("click", downloadCSV);

buildInputs();
setBandPill();
</script>
</body>
</html>
